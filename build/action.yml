name: EdgeX Snap Builder
description: |
  This action clones the source code, builds the snap using and 
  uploads the resulting snap as a build artifact

inputs:
  repo:
    description: Source code repo with snap
    required: false
    default: ${{github.repository}}

outputs:
  snap:
    description: Relative path to built snap
    value: ${{steps.snapcraft.outputs.snap}}

runs:
  using: composite

  steps:
    # Clone the source project
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
        repository: {{input.repo}}

    # Build the snap
    - uses: snapcore/action-build@v1
      id: snapcraft
    
    # Upload the snap as build artifact
    - uses: actions/upload-artifact@v2
      with:
        name: ${{steps.snapcraft.outputs.snap}}
        path: ${{steps.snapcraft.outputs.snap}}
        if-no-files-found: error
        retention-days: 7