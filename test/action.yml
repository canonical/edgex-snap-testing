name: EdgeX Snap Tester
description: |
  Github action downloads a snap and runs various smoke tests
  to validate the snap packaging.

  The snap can be optionally downloaded from build artifacts.

inputs:
  name:
    description: Name of the testing suite
    required: true
  snap:
    description: Relative path to local snap
    required: false
  channel:
    description: Channel for downloading the snap from store
    required: false
    default: latest/edge

runs:
  using: composite

  steps:
    # Download the snap from build artifacts
    - if: ${{inputs.snap != ''}}
      uses: actions/download-artifact@v2
      with:
        name: ${{inputs.snap}}

    # Set the absolute path
    - if: ${{inputs.snap != ''}}
      shell: bash
      id: path
      run: |
        echo "::set-output name=local_snap::${{github.workspace}}/${{inputs.snap}}"

    # Run smoke tests
    - shell: bash
      working-directory: ${{github.action_path}}
      env:
        LOCAL_SNAP: ${{steps.path.outputs.local_snap}}
        SERVICE_CHANNEL: ${{inputs.channel}}
      run: |
        go test -p 1 -v ./suites/${{inputs.name}}